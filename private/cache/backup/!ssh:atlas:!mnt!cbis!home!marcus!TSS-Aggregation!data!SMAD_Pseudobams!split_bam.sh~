#!/bin/bash

# Base directory on Phoebe where fastq.gz files are located
phoebe_fp="/mnt/gtklab01/xiaojing/Esther-bactg-smads/data"

# Directory where pseudobam files are to be created
pseudo_fp="/mnt/cbis/home/marcus/TSS-Aggregation/data/SMAD_Pseudobams"

# Files required by kallisto to generate pseudobam files
kallisto_idx="/mnt/cbis/home/marcus/TSS-Aggregation/data/reference_data/Homo_sapiens.GRCh38.cdna.all.idx"
kallisto_gtf="/mnt/cbis/home/marcus/TSS-Aggregation/data/reference_data/Homo_sapiens.GRCh38.94.gtf.gz"
kallisto_chom_sizes="/mnt/cbis/home/marcus/TSS-Aggregation/data/reference_data/hg38_chrom_sizes.txt"

# Loop through and execute
while read line; do
    filename=$(echo $line | cut -d " " -f 1)

    # split by chromosome names
    samtools view -b -f 3 -F 12 ${pseudo_fp}/AC1_S5/pseudoalignments.bam ${filename} > ${pseudo_fp}/AC1_S5/split_by_chr/${filename}.bam

done < ${kallisto_chom_sizes}
